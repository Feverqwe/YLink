(()=>{var e={227:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(s=n))})),t.splice(s,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(447)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,r)=>{e.exports=function(e){function t(e){let r,s,o,i=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),o=s-(r||s);n.diff=o,n.prev=r,n.curr=s,r=s,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,s)=>{if("%%"===r)return"%";i++;const o=t.formatters[s];if("function"==typeof o){const t=e[i];r=o.call(n,t),e.splice(i,1),i--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(s!==t.namespaces&&(s=t.namespaces,o=t.enabled(e)),o),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(s),...t.skips.map(s).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),s=n.length;for(r=0;r<s;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=r(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},824:e=>{var t=1e3,r=60*t,n=60*r,s=24*n;function o(e,t,r,n){var s=t>=1.5*r;return Math.round(e/r)+" "+n+(s?"s":"")}e.exports=function(e,i){i=i||{};var a,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var i=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*s;case"hours":case"hour":case"hrs":case"hr":case"h":return i*n;case"minutes":case"minute":case"mins":case"min":case"m":return i*r;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===u&&isFinite(e))return i.long?(a=e,(c=Math.abs(a))>=s?o(a,c,s,"day"):c>=n?o(a,c,n,"hour"):c>=r?o(a,c,r,"minute"):c>=t?o(a,c,t,"second"):a+" ms"):function(e){var o=Math.abs(e);return o>=s?Math.round(e/s)+"d":o>=n?Math.round(e/n)+"h":o>=r?Math.round(e/r)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},335:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,n,s,o){n=n||"&",s=s||"=";var i={};if("string"!=typeof e||0===e.length)return i;var a=/\+/g;e=e.split(n);var c=1e3;o&&"number"==typeof o.maxKeys&&(c=o.maxKeys);var u=e.length;c>0&&u>c&&(u=c);for(var l=0;l<u;++l){var h,p,f,d,y=e[l].replace(a,"%20"),m=y.indexOf(s);m>=0?(h=y.substr(0,m),p=y.substr(m+1)):(h=y,p=""),f=decodeURIComponent(h),d=decodeURIComponent(p),t(i,f)?r(i[f])?i[f].push(d):i[f]=[i[f],d]:i[f]=d}return i};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},795:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,o,i,a){return o=o||"&",i=i||"=",null===e&&(e=void 0),"object"==typeof e?n(s(e),(function(s){var a=encodeURIComponent(t(s))+i;return r(e[s])?n(e[s],(function(e){return a+encodeURIComponent(t(e))})).join(o):a+encodeURIComponent(t(e[s]))})).join(o):a?encodeURIComponent(t(a))+i+encodeURIComponent(t(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function n(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var s=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},735:(e,t,r)=>{"use strict";t.decode=t.parse=r(335),t.encode=t.stringify=r(795)},710:e=>{"use strict";class t extends Error{constructor(e){super(t._prepareSuperMessage(e)),Object.defineProperty(this,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(this,t)}static _prepareSuperMessage(e){try{return JSON.stringify(e)}catch{return String(e)}}}const r=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],n=Symbol(".toJSON called"),s=({from:e,seen:t,to_:o,forceEnumerable:i,maxDepth:a,depth:c})=>{const u=o||(Array.isArray(e)?[]:{});if(t.push(e),c>=a)return u;if("function"==typeof e.toJSON&&!0!==e[n])return(e=>{e[n]=!0;const t=e.toJSON();return delete e[n],t})(e);for(const[r,n]of Object.entries(e))"function"==typeof Buffer&&Buffer.isBuffer(n)?u[r]="[object Buffer]":"function"!=typeof n&&(n&&"object"==typeof n?t.includes(e[r])?u[r]="[Circular]":(c++,u[r]=s({from:e[r],seen:t.slice(),forceEnumerable:i,maxDepth:a,depth:c})):u[r]=n);for(const{property:t,enumerable:n}of r)"string"==typeof e[t]&&Object.defineProperty(u,t,{value:e[t],enumerable:!!i||n,configurable:!0,writable:!0});return u};e.exports={serializeError:(e,t={})=>{const{maxDepth:r=Number.POSITIVE_INFINITY}=t;return"object"==typeof e&&null!==e?s({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0}):"function"==typeof e?`[Function: ${e.name||"anonymous"}]`:e},deserializeError:(e,r={})=>{const{maxDepth:n=Number.POSITIVE_INFINITY}=r;if(e instanceof Error)return e;if("object"==typeof e&&null!==e&&!Array.isArray(e)){const t=new Error;return s({from:e,seen:[],to_:t,maxDepth:n,depth:0}),t}return new t(e)}}},182:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(s,o){function i(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((s=(s=i.trys).length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getSigFn=void 0;var o=r(227)("app:getSpeedFixFn");function i(e){var t=/\([$\w]+=([$\w]+)\([$\w]+\),[$\w]+\.set\("n",/.exec(e);if(!t)throw new Error("Sig fn name not found");var r=t[1];e=e.replace(new RegExp("([;\\n]"+r+")(=function)",""),"$1=__result__.sigFn$2");var n=new Function("","\n  const __result__ = {};\n  const navigator = {};\n  const location = {hostname:'a'};\n  const document = {location,domain:'a'};\n  const window = {document,location};\n  "+e+";\n  return __result__.sigFn;\n")();if("function"!=typeof n)throw new Error("Sig fn is not found");return n}t.getSigFn=i,t.default=function(e){return n(this,void 0,void 0,(function(){var t,r;return s(this,(function(n){switch(n.label){case 0:return[4,fetch(e)];case 1:return[4,n.sent().text()];case 2:return t=n.sent(),r=i(t),[2,function(e){var t=new URL(e);try{var n=t.searchParams.get("n");n&&t.searchParams.set("n",r(n))}catch(e){o("User sig fn error: %O",e)}return t.toString()}]}}))}))}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=r(710);const t=r(227)("app:frameWorker"),n=()=>{},s=new WeakMap;var o=r(182),i=r.n(o);const a=r(227)("app:youtube"),c=r(735),u=r(227)("app:twitch"),l=r(735),h=function(e,t){let r="https://api.twitch.tv";return r+="live"===t?"/api/channels/"+e.channel:"/api/vods/"+e.id,r+="/access_token.json",u("request token",r),fetch(r,{headers:{"Client-ID":"jzkbprff40iqj646a697cyrvl0zt2m6"}}).then((e=>e.json())).then((function(e){return u("token",e),{sig:e.sig,token:e.token}}))},p=function(e,t,r){let n="http://usher.twitch.tv";n+="live"===t?"/api/channel/hls/"+e.channel+".m3u8":"/vod/"+e.id;const s={player:"twitchweb",p:Math.trunc(1e6*Math.random()),type:"any",allow_source:!0,allow_audio_only:!0,allow_spectre:!1};return Object.assign(s,r),n+="?"+l.stringify(s),n},f=r(227)("app:goodgame"),d={1080:"",720:"_720",480:"_480",240:"_240"},y=/"channel_id":"(\d+)"/,m=r(227)("app:index");window.app=new class{constructor(){this.history=null,this.transport=null,this.services=null,this.callFn=null,this.init()}init(){this.history=new class{constructor(){this.history=this.getHistory()}getHistory(){let e=null;try{e=JSON.parse(localStorage.getItem("history"))}catch(e){}return e||{}}get(e){return Promise.resolve().then((()=>{let t=null;const r=Math.trunc(Date.now()/1e3),n=this.history[e];return n&&n.expire>r&&(t=n.data),t}))}set(e,t){return Promise.resolve().then((()=>{const r=this.history,n=Math.trunc(Date.now()/1e3);Object.keys(r).forEach((function(e){r[e].expire<n&&delete r[e]})),r[e]={expire:n+86400,data:t},localStorage.setItem("history",JSON.stringify(r))}))}},this.services=new class{constructor(){this.youtube=new class{getInfo(e){let t=null;return[/\/\/(?:[^\/]+\.)?youtu\.be\/([\w\-]+)/,/\/\/(?:[^\/]+\.)?youtube\.com\/.+[?&]v=([\w\-]+)/,/\/\/(?:[^\/]+\.)?youtube\.com\/(?:.+\/)?(?:v|embed)\/([\w\-]+)/].some((r=>{const n=r.exec(e);if(n)return t={},t.type="youtube",t.id=n[1],!0})),t}async getLinks(e){const{playerResponse:t,speedFixFn:r}=await async function(e){const{key:t,version:r,playerUrl:n}=await async function(){const e=await fetch("https://www.youtube.com/");if(!e.ok)throw new Error("Incorrect status code "+e.status);const t=await e.text();let r;r=/"INNERTUBE_API_KEY":("[^"]+")/.exec(t);const n=r&&JSON.parse(r[1]);r=/"INNERTUBE_CLIENT_VERSION":("[^"]+")/.exec(t);const s=r&&JSON.parse(r[1]);if(!n||!s)throw new Error("Client info not found");let o;if(r=/"jsUrl":("[^"]+")/.exec(t),r&&(o=JSON.parse(r[1]),o=new URL(o,e.url)),!o)throw new Error("playerUrl is empty");return{key:n,version:s,playerUrl:o}}(),s=await i()(n).catch((e=>(a("getSpeedFixFn error: %o",e),null))),o="https://www.youtube.com/youtubei/v1/player?"+c.stringify({key:t}),u=await fetch(o,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({videoId:e,context:{client:{hl:"en",clientName:"WEB",clientVersion:r}},playbackContext:{contentPlaybackContext:{referer:"https://www.youtube.com/embed/"+encodeURIComponent(e)}}})});return{playerResponse:await u.json(),speedFixFn:s}}(e.id),n=function(e,t){const r=[],{formats:n,adaptiveFormats:s,dashManifestUrl:o,hlsManifestUrl:i}=e.streamingData;if(n&&n.forEach((e=>{e.url&&r.push({type:"video",typeIndex:2,width:e.width,height:e.height,quality:e.qualityLabel,url:a(e.url),title:e.qualityLabel})})),s&&s.forEach((e=>{if(!e.url)return;if(!/^audio\//.test(e.mimeType))return;const t=Math.round(e.bitrate/1e3),n="Audio "+t+"kbps";r.push({type:"audio",typeIndex:0,bitrate:t,quality:n,url:a(e.url),title:n})})),o){const e="DASH";r.push({type:"stream",typeIndex:1,quality:e,url:o,title:e})}if(i){const e="HLS";r.push({type:"stream",typeIndex:1,quality:e,url:i,title:e})}return r;function a(e){return t?t(e):e}}(t,r);if(n.sort(((e,t)=>e.height>t.height?-1:1)),n.sort(((e,t)=>e.bitrate>t.bitrate?-1:1)),n.sort(((e,t)=>e.typeIndex>t.typeIndex?-1:1)),!n.length)throw new Error("Links is not found!");return n}},this.twitch=new class{getInfo(e){return Promise.resolve().then((()=>{const t=[/\/\/(?:[^\/]+\.)?twitch\.tv\/videos\/(\d+)/],r=()=>{const n=t.shift();if(!n)return null;const s=n.exec(e);if(s){const t=s[1];return fetch(e).then((e=>e.text())).then((e=>{let r=null;const n=/twitch:\/\/stream\/([^'"]+)/.exec(e);return n&&(r={},r.type="twitch",r.channel=n[1],r.videoType="v",r.id=t),r})).catch((t=>{u("fetch error",e,t)}))}return r()};return r()})).then((t=>t||(()=>{let t=null;return[/\/\/(?:[^\/]+\.)?twitch\.tv\/(\w+)(?:\/(v)\/(\d+))?/].some((function(r){const n=r.exec(e);if(n)return t={},t.type="twitch",t.channel=n[1],t.videoType=n[2],t.id=n[3],!0})),t})()))}getLinks(e){return(e=>{let t=null;if(e.id){if("v"!==e.videoType)throw new Error("Video type "+e.videoType+" not supported!");t=h(e,"video").then((function(t){return u("auth: "+JSON.stringify(t)),p(e,"video",{nauthsig:t.sig,nauth:t.token})}))}else t=h(e,"live").then((function(t){return u("auth: "+JSON.stringify(t)),p(e,"live",{sig:t.sig,token:t.token})}));return t})(e).then((function(e){return{url:e,quality:"",mime:"video/m3u8"}}))}},this.goodgame=new class{getInfo(e){let t=null;return[/(\/\/(?:[^\/]+\.)?goodgame\.ru\/channel\/(\w+))/].some((function(r){const n=r.exec(e);if(n)return t={},t.type="goodgame",t.id=n[2],t.url="https:"+n[1],!0})),t}getLinks(e){return(e=>{return(t=e.url,f("getStreamId",t),fetch(t,{headers:{Referer:t}}).then((e=>e.text())).then((function(e){const t=y.exec(e),r=t&&t[1];if(!r)throw new Error("Stream id is not found!");return r}))).then((function(e){return f("stream_id",e),t=Object.keys(d).map((function(t){const r=d[t];return{url:"https://hlss.goodgame.ru/hls/{0}{1}.m3u8".replace("{0}",e).replace("{1}",r),quality:parseInt(t,10),mime:"video/m3u8",title:t}})).sort((function(e,t){return e.quality>t.quality?-1:1})),Promise.all(t.map((e=>fetch(e.url,{method:"HEAD"}).then((t=>e),(e=>(f("Request link error: %O",e),null)))))).then((e=>{const t=e.filter((e=>!!e));if(!t.length)throw new Error("Stream checking error!");return t}));var t}));var t})(e).then((function(e){return e}))}}}},this.transport=new class{constructor(e,t){this.transportId=Math.trunc(1e3*Math.random()),this.callbackIndex=0,this.transport=e,this.actions=t,this.cbMap=new Map,this.onMessage=this.onMessage.bind(this),this.transport.onMessage(this.onMessage)}listener(e,t){if("callFn"===e.action)return this.responseFn(e,t),!0}onMessage(e){const r=this.cbMap;if(e.responseId){const n=r.get(e.responseId);n?n(e.message):t("Callback is not found",e)}else{let r;e.callbackId?(s=t=>{this.transport.postMessage({responseId:e.callbackId,message:t})},r=(...e)=>{s&&s(...e),s=null}):r=n;let o=null;try{o=this.listener(e.message,r)}catch(e){t("Call listener error",e)}!0!==o&&r()}var s}sendMessage(e,t){const r=this.cbMap,n={message:e};if(t){n.callbackId=this.transportId+"_"+ ++this.callbackIndex;const e=e=>{r.delete(n.callbackId),t(e)};r.set(n.callbackId,e),s.has(t)&&(s.delete(t),s.set(e,!0))}try{this.transport.postMessage(n)}catch(e){throw r.delete(n.callbackId),e}}waitPromise(t){return new Promise(((r,n)=>{const o=t=>t?t.err?n((0,e.deserializeError)(t.err)):r(t.result):n(new Error("Response is empty"));s.set(o,!0),this.sendMessage(t,o)}))}callFn(e,t=[]){return this.waitPromise({action:"callFn",fn:e,args:t})}responsePromise(r,n){return r.then((e=>{n({result:e})}),(t=>{n({err:(0,e.serializeError)(t)})})).catch((function(e){t("responsePromise error",e)})),!0}resolvePath(e){const t=e.split("."),r=t.pop();let n=this.actions;for(;t.length;)n=n[t.shift()];return{scope:n,endPoint:r}}responseFn(e,t){const r=Promise.resolve().then((()=>{const{scope:t,endPoint:r}=this.resolvePath(e.fn);return t[r].apply(t,e.args)}));return this.responsePromise(r,t)}destroy(){this.cbMap.forEach((t=>{s.has(t)?t({err:(0,e.serializeError)(new Error("Destroyed"))}):t()}))}}({postMessage:function(e){parent.postMessage(JSON.stringify(e),"*")},onMessage:function(e){window.onmessage=function(t){e(JSON.parse(t.data))}}},this.api),this.callFn=this.transport.callFn.bind(this.transport),this.callFn("ready")}async onGetLink(e,t){let r;if(Array.isArray(t)){const e=t.map((e=>e.title));r=await this.callFn("choose",[{title:"Choose link",list:e}]).then((e=>"number"==typeof e?t[e]:null))}else r=t;r?(this.callFn("setStatus",[`${e.type}: ${r.quality?"Found "+r.quality:"Found!"}`]),this.callFn("openUrl",[{url:r.url,mime:r.mime}])):this.callFn("setStatus",["Empty choose"])}getInfo(e){return Promise.resolve().then((()=>{const t=Object.keys(this.services),r=()=>{const n=t.shift();if(!n)throw new Error("Service is not found");return Promise.resolve().then((()=>this.services[n].getInfo(e))).then((e=>e||r()),(e=>(m(`getInfo error ${n}`,e),r())))};return r()}))}get api(){return{getVideoLink:e=>this.getInfo(e).then((e=>(this.callFn("setStatus",["Service: "+e.type]),this.history.get(JSON.stringify(e)).then((e=>{if(e)return this.callFn("confirm",[{message:"Open link from history?"}]).then((t=>t?e:null))})).then((t=>t||(this.callFn("setStatus",[`${e.type}: Request links`]),this.services[e.type].getLinks(e).then((t=>(this.history.set(JSON.stringify(e),t),t)))))).then((t=>this.onGetLink(e,t)))))).catch((e=>{this.callFn("setStatus",[`Error: ${e.message}`])}))}}}})()})();